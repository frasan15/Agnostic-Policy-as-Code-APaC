- hosts: localhost
  tasks:
  - name: Deploy an instance
    openstack.cloud.server:
      state: present
      name: webserver
      auth:
        auth_url: "{{ lookup('env', 'OS_AUTH_URL') }}"
        username: "{{ lookup('env', 'OS_USERNAME') }}"
        password: "{{ lookup('env', 'OS_PASSWORD') }}"
        project_name: "{{ lookup('env', 'OS_PROJECT_NAME') }}"
        domain_name: "{{ lookup('env', 'OS_USER_DOMAIN_NAME') }}"
      image: db1bc18e-81e3-477e-9067-eecaa459ec33
      key_name: MySecondKey
      timeout: 200
      flavor: gx1.2c4r
      network: MySecondNetwork
      security_groups: default
      wait: true

  - name: Floating ip allocation 
    openstack.cloud.floating_ip:
      server: webserver
      wait: true
  